<!DOCTYPE html><html lang="en"><script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css"><script src="/live2d-widget/autoload.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css"><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="/tipuesearch/tipuesearch_content.js"></script><link rel="stylesheet" href="/tipuesearch/tipuesearch.css"><script src="/tipuesearch/tipuesearch_set.js"></script><script src="/tipuesearch/tipuesearch.min.js"></script><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>SpringBoot笔记整理 | MaoZH</title><script src="https://cdn.bootcss.com/valine/1.4.4/Valine.min.js"></script><script src="https://cdn.bootcdn.net/ajax/libs/mermaid/8.11.0/mermaid.min.js"></script><script>mermaid.initialize({
  startOnLoad: true
  , theme: 'dark'
});</script><link rel="stylesheet" href="/css/arknights.css"><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/highlight.js/10.1.2/styles/atom-one-dark-reasonable.min.css"><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="MaoZH" type="application/atom+xml">
</head><body><header><nav><a href="/">Home</a><a href="/archives/">Archives</a></nav></header><main><article><div id="post-bg"><div id="post-title"><h1>SpringBoot笔记整理</h1><hr></div><div id="post-content"><h2 id="SpringBoot"><a href="#SpringBoot" class="headerlink" title="SpringBoot"></a>SpringBoot</h2><p>javaweb：独立开发mvc三层架构的网站，最原始的网站项目</p>
<p>ssm框架：简化了开发的流程，配置也比较复杂</p>
<p>spring再进行简化，并且内嵌tomcat</p>
<p>==微服务阶段:==springboot</p>
<p>==什么是springboot==</p>
<p>Springboot基于Spring开发，其本身并不提供Spring框架的核心特性以及扩展功能，只是用于快速、敏捷地开发新一代基于Spring框架的应用程序，并不是用它来替代Spring的解决方案，而是和Spring框架紧密结合用于提升Spring开发者体验的工具，SpringBoot有<strong>约定大于配置的</strong>核心思想，默认帮我们进行了很多设置，多数SpringBoot应用只需很少Spring配置，同时它集成了大量常用的第三方库配置(Redis,MongoDB,jpa,RabbitMQ,Quartz等等)，SpringBoot应用中这些第三方库几乎可以零配置开箱即用</p>
<p>Spring Boot的主要优点:</p>
<span id="more"></span> 

<ul>
<li>为所有Spring开发者更快的入门</li>
<li>开箱即用，提供各种默认配置来简化项目配置</li>
<li>内嵌式容器简化Web项目</li>
<li>没有冗余代码生成和XML配置的要求</li>
</ul>
<h2 id="微服务架构"><a href="#微服务架构" class="headerlink" title="微服务架构"></a>微服务架构</h2><p>微服务是一种架构风格，它要求我们在开发一个应用的时候，这个应用必须构建成一系列小服务的组合;可以通过http的方式进行互通。</p>
<p><strong>单体应用架构</strong>：将一个应用中的所有应用服务都封装在一个应用中，如数据库访web访问等等各个功能放到一个war包当中</p>
<p><strong>微服务架构：</strong>打破之前的单体架构方式，把每个功能元素独立出来，把独立出来的功能元素进行动态组合，需要的功能元素才拿去组合。</p>
<ul>
<li>节省了调用资源</li>
<li>每一个功能元素的服务都是一个可替换、可独立升级的软件代码(高内聚低耦合)</li>
</ul>
<h2 id="简单开发一个springboot项目"><a href="#简单开发一个springboot项目" class="headerlink" title="简单开发一个springboot项目"></a>简单开发一个springboot项目</h2><ul>
<li>可以在官网直接下载，导入idea开发(<a target="_blank" rel="noopener" href="https://start.spring.io/">https://start.spring.io/</a>)</li>
<li>直接使用idea创建一个springboot项目</li>
<li>导入依赖，官网依赖：<a target="_blank" rel="noopener" href="https://mvnrepository.com/">https://mvnrepository.com/</a></li>
</ul>
<p>pom.xml配置文件分析</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.5.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span>/&gt;</span> <span class="hljs-comment">&lt;!-- lookup parent from repository --&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.mao<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springboot-01-helloworld<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>springboot-01-helloworld<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span>Demo project for Spring Boot<span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br><br></code></pre></td></tr></table></figure>

<p><img src="/2021/10/06/SpringBoot%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/image-20210728233218006.png" alt="image-20210728233218006"></p>
<h2 id="SpringBoot原理"><a href="#SpringBoot原理" class="headerlink" title="SpringBoot原理"></a>SpringBoot原理</h2><p>pom.xml</p>
<ul>
<li>spring-boot-dependencies:核心依赖在父工程中</li>
<li>引入Spring依赖的时候不需要指定版本，因为有相应的版本仓库</li>
</ul>
<p>启动器</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>启动器：就是Springboot的启动场景</p>
<p>如：spring-boot-starter-web就会自动导入web环境所有的依赖</p>
<p>springboot会将所有的功能场景变为一个个启动器，需要使用什么功能就只需要找到对应的启动器即可</p>
<p>==主程序：==</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//标注这个类是一个springboot应用:启动类下的所有资源</span><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Springboot01HelloworldApplication</span> </span>&#123;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        SpringApplication.run(Springboot01HelloworldApplication.class, args);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p>注解深入：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//分析源码，根据注解逐步深入</span><br></code></pre></td></tr></table></figure>

<p><img src="/2021/10/06/SpringBoot%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/image-20210729234115307.png" alt="image-20210729234115307"></p>
<p><img src="/2021/10/06/SpringBoot%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/image-20210729234035743.png" alt="image-20210729234035743"></p>
<p>结论：Springboot所有的自动配置都是在启动的时候扫描并加载：spring.factories所有的自动配置类都在里面，但是只有满足相应的条件，导入相应的start就有对应的启动器了，有了启动器自动装配才会生效</p>
<p><img src="/2021/10/06/SpringBoot%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/image-20210729235146757.png" alt="image-20210729235146757"></p>
<ul>
<li>springboot在启动的时候从类路径下/MENA-INF/spring.properties获取指定的值</li>
<li>将这些自动配置的类倒入容器自动配置，自动配置就会生效</li>
<li>以前需要自动配置的东西现在springboot自动完成</li>
<li>整合javaee，解决方案和自动配置的东西都在spring-boot-autoconfigure-2.2.0RELEASE.jar包下</li>
<li>它会把所有需要导入的组件以类名方式返回，这些组件就会自动被添加到容器中</li>
<li>容器中也会存在非常多的xxxAutoConfiguration的文件(@Bean)，就是这些类给容器中导入了这个场景需要的所有组件并自动配置</li>
<li>有了自动配置类免去了手动配置文件编写工作</li>
</ul>
<p><img src="/2021/10/06/SpringBoot%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/image-20210729235254848.png" alt="image-20210729235254848"></p>
<p><img src="/2021/10/06/SpringBoot%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/image-20210729235324734.png" alt="image-20210729235324734"></p>
<p>==SpringApplication.run方法分析==</p>
<p>SpringApplication类主要：<br>1.推断应用的类型是普通的项目还是Web项目<br>2.查找并加载所有可用初始化器，设置到initializers属性中<br>3.找出所有的应用程序监听器设置到listeners属性当中<br>4.推断并设置main方法的定义类，找到运行的主类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">SpringApplication</span><span class="hljs-params">(ResourceLoader resourceloader, Class... primarySources)</span> </span>&#123;<br><span class="hljs-keyword">this</span>.sources = <span class="hljs-keyword">new</span> LinkedHashSet();<br><span class="hljs-keyword">this</span>. bannerMode = Mode. CONSOLE;<br><span class="hljs-keyword">this</span>.1ogstartupInfo = <span class="hljs-keyword">true</span>;<br><span class="hljs-keyword">this</span>. addCommandlineProperties = <span class="hljs-keyword">true</span>;<br><span class="hljs-keyword">this</span>. addConversionService = <span class="hljs-keyword">true</span>;<br><span class="hljs-keyword">this</span>.headless = <span class="hljs-keyword">true</span>; .<br><span class="hljs-keyword">this</span>. regi sterShutdownHook = <span class="hljs-keyword">true</span>;<br><span class="hljs-keyword">this</span>.additionalProfiles = <span class="hljs-keyword">new</span> MHashSet();<br><span class="hljs-keyword">this</span>. isCustomEnvironment = <span class="hljs-keyword">false</span>; .<br><span class="hljs-keyword">this</span>.resourceLoader = resourceLoader;<br>Assert.notNull(primarySources, <span class="hljs-string">&quot;PrimarySources must not be nu11&quot;</span>);<br><span class="hljs-keyword">this</span>.primarySources = <span class="hljs-keyword">new</span> LinkedHashSet(Arrays.asList(primarySources));<br><span class="hljs-keyword">this</span>. webApplicationType = WebApplicationType. deduceFromClasspath();<br><span class="hljs-keyword">this</span>.setInitializers(<span class="hljs-keyword">this</span>.getSpringFactoriesInstances (App1 icationContextInitialization))<br><span class="hljs-keyword">this</span>.setlisteners(<span class="hljs-keyword">this</span>. getSpringFactoriesInstances(Applicationlistener.class));<br><span class="hljs-keyword">this</span>.mainApplicationClass = <span class="hljs-keyword">this</span>. deduceMainApplicationClass();<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="config配置"><a href="#config配置" class="headerlink" title="config配置"></a>config配置</h2><p><img src="/2021/10/06/SpringBoot%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/image-20210730232014862.png" alt="image-20210730232014862"></p>
<p>创建项目时勾选这个实现热部署</p>
<p>springboot这个配置文件可以配置很多东西，官网配置详解：<br><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.6.RELEASE/reference/htmlsingle/#boot-features-external-config">https://docs.spring.io/spring-boot/docs/2.1.6.RELEASE/reference/htmlsingle/#boot-features-external-config</a></p>
<p><em><strong>配置文件  -&gt;  xxxProperties(与前者绑定)  -&gt;  xxxAutoConfiguration(依赖前者，同时本身也有默认配置类)</strong></em></p>
<p>==自动配置原理：==</p>
<p>1)SpringBoot启动会加载大量的自动配置类<br>2)看需要的功能有没有在SpringBoot默认写好的自动配置类当中;<br>3)看这个自动配置类中到底配置了哪些组件; (只要要用的组件存在在其中，我们<br>就不需要再手动配置了)<br>4)给容器中自动配置类添加组件的时候，会从properties类中获取某些属性。我们只需要在配置文件中指定这些属性的值即可;<br>xxxxAutoConfigurartion:自动配置类;给容器中添加组件<br>xxxxProperties:封装配置文件中相关属性;</p>
<p>springboot使用一个全局的配置文件，文件名称是固定的</p>
<ul>
<li>application.properties<ul>
<li>语法结构:key=value</li>
</ul>
</li>
<li>application.yml<ul>
<li>语法结构：key:空格value</li>
</ul>
</li>
</ul>
<figure class="highlight yml"><table><tr><td class="code"><pre><code class="hljs yml"><span class="hljs-comment">#application.yaml</span><br><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">81</span><br><span class="hljs-comment">#对象</span><br><span class="hljs-attr">student:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">mao</span><br>  <span class="hljs-attr">age:</span> <span class="hljs-number">18</span><br><br><span class="hljs-comment">#行内写法</span><br><span class="hljs-attr">student2:</span> &#123;<span class="hljs-attr">name:</span> <span class="hljs-string">mao</span>, <span class="hljs-attr">age:</span> <span class="hljs-number">18</span>&#125;<br><span class="hljs-comment">#数组</span><br><span class="hljs-attr">pet:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">cat</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">dog</span><br><span class="hljs-attr">pet2:</span> [<span class="hljs-string">cat</span>, <span class="hljs-string">dog</span>]<br></code></pre></td></tr></table></figure>

<figure class="highlight properties"><table><tr><td class="code"><pre><code class="hljs properties"><span class="hljs-comment">#application.properties</span><br><span class="hljs-comment">#只能保存键值对</span><br><span class="hljs-meta">server.port</span>=<span class="hljs-string">81</span><br><span class="hljs-meta">student.name</span>=<span class="hljs-string">mao</span><br><span class="hljs-meta">student.age</span>=<span class="hljs-string">18</span><br></code></pre></td></tr></table></figure>

<p>yaml可以直接给实体类赋值</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@ConfigurationProperties(prefix = &quot;person&quot;)</span><span class="hljs-comment">//加入这个注解，prefix设为yaml配置相对应</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> Integer age;<br>    <span class="hljs-keyword">private</span> Boolean happy;<br>    <span class="hljs-keyword">private</span> Date birth;<br>    <span class="hljs-keyword">private</span> Map&lt;String, Object&gt; maps;<br>    <span class="hljs-keyword">private</span> List&lt;Object&gt; lists;<br>    <span class="hljs-keyword">private</span> Dog dog;<br>&#125;<br><br>##对应配置<br>person:<br>  name: mao<br>  age: <span class="hljs-number">3</span><br>  happy: <span class="hljs-keyword">true</span><br>  birth: <span class="hljs-number">20201224</span><br>  maps: &#123;k1: v1, k1: v2&#125;<br>  lists:<br>    - code<br>    - music<br>  dog:<br>    name: $&#123;person.dogname:dog1&#125;_wangwang<span class="hljs-comment">//person.dogname存在则取否则取dog1</span><br>    age: <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>

<p><img src="/2021/10/06/SpringBoot%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/image-20210731000052868.png" alt="image-20210731000052868"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">//加载指定目录下的配置文件<br>@PropertySource(value=&quot;classpath:mao.properties&quot;)<br>public class Person &#123;<br>	//取出配置文件当中的值<br>	@Value(&quot;$&#123;name&#125;&quot;)<br>    private String name;<br>&#125;<br><br>对应的mao.properties<br>name=maozhihui<br></code></pre></td></tr></table></figure>

<p><img src="/2021/10/06/SpringBoot%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/image-20210801160032705.png"></p>
<p>结论：<br>●配置yml和配置properties都可以获取到值，强烈推荐 yml<br>●如果我们在某个业务中，只需要获取配置文件中的某个值，可以使用一下@value<br>●如果说，我们专门编写了一个JavaBean来和配置文件进行映射，就直接使用<br>@configurationProperties</p>
<p>==JSR303校验==</p>
<p>@Validated()//给需要的类添加相应的注解</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml">@NotNull(message=&quot;名字不能为空&quot;)<br>private String userName;<br>@Max(value=120 ,message=&quot;年龄最大不能查过120&quot; )<br>private int age;<br>@Email(message=&quot;邮箱格式错误&quot;)<br>private String email;<br><br>空检查<br>@Null 验证对象是否为null<br>@NotNull 验证对象是否不为null,无法查检长度为0的字符串<br>@NotBlank 检查约束字符串是不是Nu11还有被Trim的长度是否大于e,只对字符串,且会去掉前后空格。<br>@NotEmpty 检查约束元素是否为NULL或者是EMPTY.<br><br>Booelan检查<br>@AssertTrue 验证Boolean对象是否为true<br>@AssertFalse 验证Boolean 对象是否为false<br><br>长度检查<br>@Size(min=, max=)验证对象(Array,Collection,Map, String)长度是否在给定的范围之内<br>@Length(min=, max=) Validates that the annotated string is between min and max included.<br><br>日期检查<br>@Past 验证Date和Calendar对象是否在当前时间之前<br>@Future 验证Date和Calendar对象是否在当前时间之后<br>@Pattern 验证String 对象是否符合正则表达式的规则<br><br></code></pre></td></tr></table></figure>

<p><strong>多环境配置及配置文件位置</strong></p>
<p>配置文件可以放的位置有：file指的项目目录下；classpath指的resources目录下<br>1.file:./config/<br>2.file:./<br>3.classpath:/config/<br>4.classpath:/</p>
<p>项目读取配置文件的优先级为：1&gt;2&gt;3&gt;4</p>
<p>多环境的配置以及选用方式：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml">假设在默认路径上配置三个环境，需要三个配置文件<br>1.application.properties<br>spring.profiles.active=dev # 选择dev环境激活该配置文件<br><br><br><br>2.application-dev.properties<br>server.port=8081<br>3.application-test.properties<br>server.port=8081<br></code></pre></td></tr></table></figure>

<p>如果使用的是yam方式进行配置则只需要一个文件</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8081</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">profiles:</span><br>    <span class="hljs-attr">active:</span> <span class="hljs-string">dev</span> <span class="hljs-comment"># 选择需要激活的配置文件</span><br><span class="hljs-meta">---</span><br><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8082</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">profiles:</span> <span class="hljs-string">dev</span><br> <br><span class="hljs-meta">---</span><br><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8083</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">profiles:</span> <span class="hljs-string">test</span><br></code></pre></td></tr></table></figure>

<p>查看当前的配置生效情况</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml">debug: true<br></code></pre></td></tr></table></figure>

<p><img src="/2021/10/06/SpringBoot%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/image-20210801165325150.png" alt="image-20210801165325150"></p>
<p><img src="/2021/10/06/SpringBoot%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/image-20210801165419214.png" alt="image-20210801165419214"></p>
<p><img src="/2021/10/06/SpringBoot%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/image-20210801165528493.png" alt="image-20210801165528493"></p>
<h2 id="springboot-web开发"><a href="#springboot-web开发" class="headerlink" title="springboot web开发"></a>springboot web开发</h2><p>静态资源导入代码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addResourceHandlers</span><span class="hljs-params">(ResourceHandlerRegistry registry)</span> </span>&#123;<br>            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.resourceProperties.isAddMappings()) &#123;<br>                logger.debug(<span class="hljs-string">&quot;Default resource handling disabled&quot;</span>);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-keyword">this</span>.addResourceHandler(registry, <span class="hljs-string">&quot;/webjars/**&quot;</span>, <span class="hljs-string">&quot;classpath:/META-INF/resources/webjars/&quot;</span>);<br>                <span class="hljs-keyword">this</span>.addResourceHandler(registry, <span class="hljs-keyword">this</span>.mvcProperties.getStaticPathPattern(), (registration) -&gt; &#123;<br>                    registration.addResourceLocations(<span class="hljs-keyword">this</span>.resourceProperties.getStaticLocations());<br>                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.servletContext != <span class="hljs-keyword">null</span>) &#123;<br>                        ServletContextResource resource = <span class="hljs-keyword">new</span> ServletContextResource(<span class="hljs-keyword">this</span>.servletContext, <span class="hljs-string">&quot;/&quot;</span>);<br>                        registration.addResourceLocations(<span class="hljs-keyword">new</span> Resource[]&#123;resource&#125;);<br>                    &#125;<br><br>                &#125;);<br>            &#125;<br>        &#125;<br></code></pre></td></tr></table></figure>

<p>webjars:</p>
<p><a target="_blank" rel="noopener" href="https://www.webjars.org/">https://www.webjars.org/</a></p>
<p>根据源码的描述，静态资源的存放位置有4个：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">&quot;classpath:/META-INF/resources/&quot;,<br>&quot;classpath:/resources/&quot;,<br>&quot;classpath:/static/&quot;, <br>&quot;classpath:/public/&quot;<br></code></pre></td></tr></table></figure>

<p>1.在springboot中可以使用以下方式处理静态资源</p>
<ul>
<li><p>webjars:     其访问方式：localhost:8080/webjars/**</p>
<p><img src="/2021/10/06/SpringBoot%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/image-20210801204621222.png" alt="image-20210801204621222"></p>
</li>
<li><p>public,static,/**,resources 其访问方式：localhost:8080</p>
</li>
</ul>
<p>2.优先级</p>
<p>resources&gt;</p>
<p><img src="/2021/10/06/SpringBoot%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/image-20210801203738656.png" alt="image-20210801203738656"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addResourceHandlers</span><span class="hljs-params">(ResourceHandlerRegistry registry)</span> </span>&#123;<br>            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.resourceProperties.isAddMappings()) &#123;<br>                logger.debug(<span class="hljs-string">&quot;Default resource handling disabled&quot;</span>);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-keyword">this</span>.addResourceHandler(registry, <span class="hljs-string">&quot;/webjars/**&quot;</span>, <span class="hljs-string">&quot;classpath:/META-INF/resources/webjars/&quot;</span>);<br>                <span class="hljs-keyword">this</span>.addResourceHandler(registry, <span class="hljs-keyword">this</span>.mvcProperties.getStaticPathPattern(), (registration) -&gt; &#123;<br>                    registration.addResourceLocations(<span class="hljs-keyword">this</span>.resourceProperties.getStaticLocations());<br>                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.servletContext != <span class="hljs-keyword">null</span>) &#123;<br>                        ServletContextResource resource = <span class="hljs-keyword">new</span> ServletContextResource(<span class="hljs-keyword">this</span>.servletContext, <span class="hljs-string">&quot;/&quot;</span>);<br>                        registration.addResourceLocations(<span class="hljs-keyword">new</span> Resource[]&#123;resource&#125;);<br>                    &#125;<br><br>                &#125;);<br>            &#125;<br>        &#125;<br></code></pre></td></tr></table></figure>

<h2 id="首页"><a href="#首页" class="headerlink" title="首页"></a>首页</h2><p><img src="/2021/10/06/SpringBoot%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/image-20210801211808311.png" alt="image-20210801211808311"></p>
<p>通过源码可以得出首页的位置应该放在和静态资源相同的位置，名字为index.html</p>
<h2 id="模板引擎"><a href="#模板引擎" class="headerlink" title="模板引擎"></a>模板引擎</h2><p>前端交给我们的页面，是html页面。如果是我们以前开发，我们需要把他们转成jsp页面，jsp好处就是当我们查出一-些数据转发到JSP页面以后，我们可以用jsp轻松实现数据的显示，及交互等。jsp支持非常强大的功能，包括能写Java代码，但是呢，我们现在的这种情况，SpringBoot这个项目首先是以jar的方式，不是war,像第二，我们用的还是嵌入式的Tomcat,所以呢，他现在默认是不支持jsp的。<br>那不支持jsp,如果我们直接用纯静态页面的方式，那给我们开发会带来非常大的麻烦，那怎么办呢，SpringBoot推荐你可以来使用模板引擎。那么这模板引擎，其实jsp就是一个模板弓|擎，还有以用的比较多的freemarker,包括SpringBoot给我们推荐的Thymeleaf, 模板引擎有非常多，但再多的模板引擎，他们的思想都是一样的。</p>
<p><img src="/2021/10/06/SpringBoot%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/image-20210801212253874.png" alt="image-20210801212253874"></p>
<p>模板引擎的作用就是我们来写一个页面模板，比如有些值呢，是动态的，我们写一些表达式。而这些值，从哪来呢，我们来组装一些数据， 我们把这些数据找到。然后把这个模板和这个数据交给我们模板引擎，模板引擎按照我们这个数据把这表达式解析、填充到我们指定的位置，然后把这个数据最终生成想要的内容给我们写出去， 这就是我们这个模板引擎，不管是jsp还是其他模板引擎，都是这个思想。只不过呢，就是说不同模板引擎之间，他们可能这个语法有点不一样。其他的我就不介绍了，我主要来介绍一下SpringBoot给我们推荐的Thymeleaf模板引擎，这模板引擎呢，是一个高级语言的模板引擎， 他的这个语法更简单。而且呢，功能更强大。</p>
<p><img src="/2021/10/06/SpringBoot%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/image-20210801214527482.png" alt="image-20210801214527482"></p>
<p>读源码可见thymeleaf文件需要放在templates下面</p>
<p><img src="/2021/10/06/SpringBoot%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/image-20210801214825792.png" alt="image-20210801214825792"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">thymeleafController</span> </span>&#123;<br>    <span class="hljs-meta">@RequestMapping(&quot;/test&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">thymeleaf</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;test&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>thymeleaf用法：</p>
<p><img src="/2021/10/06/SpringBoot%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/image-20210801215605635.png" alt="image-20210801215605635"><img src="/2021/10/06/SpringBoot%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/image-20210801215647547.png" alt="image-20210801215647547"></p>
<p><img src="/2021/10/06/SpringBoot%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/image-20210801215727506.png" alt="image-20210801215727506"><img src="/2021/10/06/SpringBoot%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/image-20210801215703497.png" alt="image-20210801215703497"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">thymeleafController</span> </span>&#123;<br>    <span class="hljs-meta">@RequestMapping(&quot;/test&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">thymeleaf</span><span class="hljs-params">(Model model)</span> </span>&#123;<br>        model.addAttribute(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;hello,thymeleaf&quot;</span>);<br>        model.addAttribute(<span class="hljs-string">&quot;users&quot;</span>, Arrays.asList(<span class="hljs-string">&quot;user1&quot;</span>,<span class="hljs-string">&quot;user2&quot;</span>));<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;test&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">th:each</span>=<span class="hljs-string">&quot;user:$&#123;users&#125;&quot;</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;user&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>  法一<br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">th:each</span>=<span class="hljs-string">&quot;user:$&#123;users&#125;&quot;</span>&gt;</span>[[$&#123;user&#125;]]<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>  法二<br></code></pre></td></tr></table></figure>

<h2 id="MVC配置原理"><a href="#MVC配置原理" class="headerlink" title="MVC配置原理"></a>MVC配置原理</h2><p><img src="/2021/10/06/SpringBoot%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/image-20210801221817970.png"></p>
<p>根据官方文档可以自行更改配置</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//全面扩展springmvc</span><br><span class="hljs-comment">//如果想自定义一些定制化的功能只要写这个组件然后交由springboot进行自动装配</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-comment">//@EnableWebMvc //导入了一个类：DelegatingWebMvcConfiguration:从容器当中获取所有的webmvcconfig</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyMvcConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">WebMvcConfigurer</span> </span>&#123;<br><span class="hljs-comment">//    @Bean</span><br><span class="hljs-comment">//    public ViewResolver myViewResolver()&#123;</span><br><span class="hljs-comment">//        return new MyViewResolver();</span><br><span class="hljs-comment">//    &#125;</span><br><span class="hljs-comment">//    //自定义一个视图解析器</span><br><span class="hljs-comment">//    public static class MyViewResolver implements ViewResolver&#123;</span><br><span class="hljs-comment">//        @Override</span><br><span class="hljs-comment">//        public View resolveViewName(String viewName, Locale locale) throws Exception &#123;</span><br><span class="hljs-comment">//            return null;</span><br><span class="hljs-comment">//        &#125;</span><br><span class="hljs-comment">//    &#125;</span><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addViewControllers</span><span class="hljs-params">(ViewControllerRegistry registry)</span> </span>&#123;<br>        <span class="hljs-comment">//设置试图跳转规则  访问localhost:8080/mao会找test.html</span><br>        registry.addViewController(<span class="hljs-string">&quot;/mao&quot;</span>).setViewName(<span class="hljs-string">&quot;test&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>注意：If you want to keep those Spring Boot MVC customizations and make more <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.3.9/reference/html/web.html#mvc">MVC customizations</a> (interceptors, formatters, view controllers, and other features), you can add your own <code>@Configuration</code> class of type <code>WebMvcConfigurer</code> but <strong>without</strong> <code>@EnableWebMvc</code>.</p>
<p>当使用了@Configuration时千万不能再使用@EnableWebMvc注解，因为这个注解会导入WebMvcConfigurationSupport.class类，自定义的配置类将会失效</p>
<p><img src="/2021/10/06/SpringBoot%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/image-20210801230304639.png" alt="image-20210801230304639"></p>
<p><strong>在springboot当中有很多xxxConfiguration帮助进行扩展配置，当看到这些类的时候一定要注意搞懂里面扩展了那些配置。</strong></p>
<p>spring-boot-starter的自定义：1.写一个xxxConfiguration2.写一个相对应的xxxproperties3.封装后打成jar包放入下图位置<img src="/2021/10/06/SpringBoot%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/image-20210801231349691.png" alt="image-20210801231349691"></p>
<h2 id="Springboot实战"><a href="#Springboot实战" class="headerlink" title="Springboot实战"></a>Springboot实战</h2><p>1.首页配置：所有页面的静态资源都需要使用thymeleaf接管</p>
<p>2.页面国际化</p>
<ul>
<li>需要配置i18n文件</li>
<li>如果需要在项目中进行按钮自动切换我们需要自定义组件LoacaleResolver</li>
<li>将自定义的组件配置到spring容器当中</li>
<li>注意取值使用#{}</li>
</ul>
<p>3.登录与拦截器</p>
<p>4.增删改查</p>
<p>网站开发方法：</p>
<p>1.前端界面，能够自动运行，独立化工程<br>2.设计数据库<br>3.数据接口对接：json<br>4.前后端联调测试</p>
<h2 id="springboot整合JDBC"><a href="#springboot整合JDBC" class="headerlink" title="springboot整合JDBC"></a>springboot整合JDBC</h2><p>项目：springboot-05-data</p>
<p>注意！本机安装了两个mysql版本，分别是alpha6.0.4版本的与MySQL-5.77.1版本的。好像alpha6.0.4版本的IDEA连接出现问题，把该版本的服务关闭只启动==MySQL-5.77.1==</p>
<p>配置方法：在resources下建立application.yml文件配置连接</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/mysql?useUnicode=true&amp;characterEncoding=UTF-8&amp;useJDBCCompliantTimezoneShift=true&amp;useLegacyDatetimeCode=false&amp;serverTimezone=UTC</span><br>    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JDBCController</span> </span>&#123;<br>    <span class="hljs-meta">@Autowired</span><br>    JdbcTemplate jdbcTemplate;<br>    <span class="hljs-comment">//查询数据库的信息显示在网页上</span><br>    <span class="hljs-meta">@RequestMapping(&quot;/userList&quot;)</span><br>    <span class="hljs-meta">@ResponseBody</span><br>    <span class="hljs-keyword">public</span> List&lt;Map&lt;String, Object&gt;&gt; userList()&#123;<br>        String sql = <span class="hljs-string">&quot;select * from student&quot;</span>;<br>        List&lt;Map&lt;String, Object&gt;&gt; maps = jdbcTemplate.queryForList(sql);<br>        <span class="hljs-keyword">return</span> maps;<br>    &#125;<br><br>    <span class="hljs-meta">@RequestMapping(&quot;/addUser/&#123;id&#125;/&#123;name&#125;/&#123;gender&#125;/&#123;age&#125;&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">addUser</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> <span class="hljs-keyword">int</span> id,</span></span><br><span class="hljs-params"><span class="hljs-function">                          <span class="hljs-meta">@PathVariable(&quot;name&quot;)</span> String name,</span></span><br><span class="hljs-params"><span class="hljs-function">                          <span class="hljs-meta">@PathVariable(&quot;gender&quot;)</span> String gender,</span></span><br><span class="hljs-params"><span class="hljs-function">                          <span class="hljs-meta">@PathVariable(&quot;age&quot;)</span> <span class="hljs-keyword">int</span> age)</span></span>&#123;<br>        String sql = <span class="hljs-string">&quot;insert into mybatisdb.student(s_id, s_name, s_gender, s_age)&quot;</span> + <span class="hljs-string">&quot;values(&quot;</span> +<br>                id + <span class="hljs-string">&quot;,&#x27;&quot;</span> + name + <span class="hljs-string">&quot;&#x27;,&#x27;&quot;</span> + gender + <span class="hljs-string">&quot;&#x27;,&quot;</span> + age +<span class="hljs-string">&quot;)&quot;</span>;<br>        jdbcTemplate.update(sql);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:/userList&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@RequestMapping(&quot;/updateUser/&#123;id&#125;&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">updateUser</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> <span class="hljs-keyword">int</span> id)</span></span>&#123;<br>        String sql = <span class="hljs-string">&quot;update mybatisdb.student set s_name=?, s_gender=?, &quot;</span> +<br>                <span class="hljs-string">&quot;s_age=? =  where s_id = &quot;</span> + id;<br>        <span class="hljs-comment">//封装数据</span><br>        Object[] objects = <span class="hljs-keyword">new</span> Object[<span class="hljs-number">3</span>];<br>        objects[<span class="hljs-number">0</span>] = <span class="hljs-string">&quot;大壮&quot;</span>;<br>        objects[<span class="hljs-number">1</span>] = <span class="hljs-string">&quot;男&quot;</span>;<br>        objects[<span class="hljs-number">2</span>] = <span class="hljs-number">21</span>;<br>        jdbcTemplate.update(sql, objects);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:/userList&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@RequestMapping(&quot;/updateUser/&#123;id&#125;&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">deleteUser</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> <span class="hljs-keyword">int</span> id)</span></span>&#123;<br>        String sql = <span class="hljs-string">&quot;delete mybatisdb.student where s_id = &quot;</span> + id;<br>        jdbcTemplate.update(sql);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:/userList&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="整合DRUID数据源"><a href="#整合DRUID数据源" class="headerlink" title="整合DRUID数据源"></a>整合DRUID数据源</h2><p>项目：springboot-05-data</p>
<p>Druid是阿里巴巴开源平台上一个数据库连接池实现，结合了C3P0、DBCP、 PROXOOL 等DB池的优点，同时加入了日志监控。Druid可以很好的监控DB池连接和SQL的执行情况，天生就是针对监控而生的DB连接池。Spring Boot 2.0以上默认使用Hikari数据源，可以说Hikari与Driud都是当前Java Web上最优秀的数据源，Spring Boot该如何集成Druid数据源，如何实现数据库监控。</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/mybatisdb?useUnicode=true&amp;characterEncoding=UTF-8&amp;useJDBCCompliantTimezoneShift=true&amp;useLegacyDatetimeCode=false&amp;serverTimezone=UTC</span><br>    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">com.alibaba.druid.pool.DruidDataSource</span><br>    <span class="hljs-comment">#Spring Boot 默认处不注入这些属性值的，需要自己绑定</span><br>    <span class="hljs-comment">#druid数据源专有配置</span><br>    <span class="hljs-attr">initialSize:</span> <span class="hljs-number">5</span><br>    <span class="hljs-attr">minIdle:</span> <span class="hljs-number">5</span><br>    <span class="hljs-attr">maxActive:</span> <span class="hljs-number">20</span><br>    <span class="hljs-attr">maxWait:</span> <span class="hljs-number">60000</span><br>    <span class="hljs-attr">timeBetweenEvictionRunsMillis:</span> <span class="hljs-number">60000</span><br>    <span class="hljs-attr">minEvictableIdleTimeMillis:</span> <span class="hljs-number">300000</span><br>    <span class="hljs-attr">validationQuery:</span> <span class="hljs-string">SELECT</span> <span class="hljs-number">1</span> <span class="hljs-string">FROM</span> <span class="hljs-string">DUAL</span><br>    <span class="hljs-attr">testWhileIdle:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">testonBorrow:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-attr">testonReturn:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-attr">poolPreparedStatements:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-comment">#配置监控统计当截的filters.stat: 监控统计、log4j; 日志记录，wall; 防御sqL注入</span><br>    <span class="hljs-comment">#如果允许时报错，java. Lang. ClassNotFoundException: org. apache. log4j. Priority</span><br>    <span class="hljs-comment">#则导入log4j 依赖即可，Maven 地址: https://mvnrepository. com/artifact/Log4j/Log4j</span><br>    <span class="hljs-attr">filters:</span> <span class="hljs-string">stat,wa1l,1og4j</span><br>    <span class="hljs-attr">maxPoolPreparedStatementPerConnectionSize:</span> <span class="hljs-number">20</span><br>    <span class="hljs-attr">useGlobalDataSourceStat:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">connectionProperties:</span> <span class="hljs-string">druid.stat.mergeSql=true;druid.stat.s1owSq1Millis=500</span><br><br></code></pre></td></tr></table></figure>

<p>自定义后台监控sql以及过滤器</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DruidConfig</span> </span>&#123;<br>    <span class="hljs-meta">@ConfigurationProperties(prefix = &quot;spring.datasource&quot;)</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> DataSource <span class="hljs-title">druidDataSource</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> DruidDataSource();<br>    &#125;<br>    <span class="hljs-comment">//后台监控功能</span><br>    <span class="hljs-comment">//因为springboot内置了servlet容器没有了web.xml,使用ServletRegistrationBean替代注册</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> ServletRegistrationBean <span class="hljs-title">statViewServlet</span><span class="hljs-params">()</span> </span>&#123;<br>        ServletRegistrationBean&lt;StatViewServlet&gt; bean = <span class="hljs-keyword">new</span> ServletRegistrationBean&lt;&gt;(<span class="hljs-keyword">new</span> StatViewServlet(), <span class="hljs-string">&quot;/druid/*&quot;</span>);<br>        <span class="hljs-comment">//后台登录</span><br>        Map&lt;String, String&gt; initParameters = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<br>        initParameters.put(<span class="hljs-string">&quot;loginUsername&quot;</span>, <span class="hljs-string">&quot;admin&quot;</span>);<br>        initParameters.put(<span class="hljs-string">&quot;loginPassword&quot;</span>, <span class="hljs-string">&quot;123456&quot;</span>);<br>        <span class="hljs-comment">//允许谁能访问</span><br>        initParameters.put(<span class="hljs-string">&quot;allow&quot;</span>, <span class="hljs-string">&quot;&quot;</span>);<br>        <span class="hljs-comment">//禁止谁访问</span><br>        <span class="hljs-comment">//initParameters.put(&quot;mao&quot;,&quot;192.168.0.1&quot;);</span><br>        bean.setInitParameters(initParameters);<br>        <span class="hljs-keyword">return</span> bean;<br>    &#125;<br>    <span class="hljs-comment">//filters配置过滤器</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> FilterRegistrationBean <span class="hljs-title">webStatFilter</span><span class="hljs-params">()</span></span>&#123;<br>        FilterRegistrationBean bean = <span class="hljs-keyword">new</span> FilterRegistrationBean();<br>        bean.setFilter(<span class="hljs-keyword">new</span> WebStatFilter());<br>        <span class="hljs-comment">//键值对设置需要的配置</span><br>        Map&lt;String, String&gt; initParameters = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<br>        <span class="hljs-comment">//设置不进行统计的</span><br>        initParameters.put(<span class="hljs-string">&quot;exclusions&quot;</span>,<span class="hljs-string">&quot;*.js,*.css,/druid/*&quot;</span>);<br>        bean.setInitParameters(initParameters);<br>        <span class="hljs-keyword">return</span> bean;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="整合mybatis"><a href="#整合mybatis" class="headerlink" title="整合mybatis"></a>整合mybatis</h2><p>项目：springboot-05-mybatis</p>
<p>官网：<a target="_blank" rel="noopener" href="https://mybatis.net.cn/getting-started.html">https://mybatis.net.cn/getting-started.html</a></p>
<p>mapper.xml头文件</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">mapper</span></span><br><span class="hljs-meta">  <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><br><span class="hljs-meta">  <span class="hljs-meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;org.mybatis.example.BlogMapper&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;com.mao.mapper.StudentMapper&quot;</span>&gt;</span><br>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>整合步骤：<br>1.导入依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/org.mybatis.spring.boot/mybatis-spring-boot-starter --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.3.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>2.配置文件</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><code class="hljs properties"><span class="hljs-meta">spring.datasource.username</span>=<span class="hljs-string">root</span><br><span class="hljs-meta">spring.datasource.password</span>=<span class="hljs-string">root</span><br><span class="hljs-meta">spring.datasource.url</span>=<span class="hljs-string">jdbc:mysql://localhost:3306/mybatisdb?useUnicode=true&amp;characterEncoding=UTF-8&amp;useJDBCCompliantTimezoneShift=true&amp;useLegacyDatetimeCode=false&amp;serverTimezone=UTC</span><br><span class="hljs-meta">spring.datasource.driver-class-name</span>=<span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># 整合mybatis</span><br><span class="hljs-meta">mybatis.type-aliases-package</span>=<span class="hljs-string">com.mao.pojo</span><br><span class="hljs-meta">mybatis.mapper-locations</span>=<span class="hljs-string">classpath:mybatis/mapper/*.xml</span><br></code></pre></td></tr></table></figure>

<p>3.编写mapper接口</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Mapper</span><br><span class="hljs-meta">@Repository</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">StudentMapper</span> </span>&#123;<br>    <span class="hljs-function">List&lt;Student&gt; <span class="hljs-title">queryStudentList</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function">Student <span class="hljs-title">queryStudentById</span><span class="hljs-params">(Integer id)</span></span>;<br>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">addStudent</span><span class="hljs-params">(Student student)</span></span>;<br>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">updateStudent</span><span class="hljs-params">(Student student)</span></span>;<br>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">deleteStudent</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;id&quot;)</span> Integer id)</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>4.编写xml配置</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">mapper</span></span><br><span class="hljs-meta">  <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><br><span class="hljs-meta">  <span class="hljs-meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;org.mybatis.example.BlogMapper&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;com.mao.mapper.StudentMapper&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;queryStudentList&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;Student&quot;</span>&gt;</span><br>    select * from mybatisdb.student<br>  <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;queryStudentById&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;Student&quot;</span>&gt;</span><br>        select * from mybatisdb.student where s_id=#&#123;s_id&#125;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;addStudent&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;Student&quot;</span>&gt;</span><br>        insert into mybatisdb.student (s_id,s_name, s_gender, s_age) values (#&#123;s_id&#125;,#&#123;s_name&#125;,#&#123;s_gender&#125;,#&#123;s_age&#125;)<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;updateStudent&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;Student&quot;</span>&gt;</span><br>        update mybatisdb.student set s_name=#&#123;s_name&#125;,s_gender=#&#123;s_gender&#125;,s_age=#&#123;s_age&#125; where s_id=#&#123;s_id&#125;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span><br><span class="hljs-comment">&lt;!--此时这里的id是在接口当中使用了@Param(&quot;id&quot;)--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">delete</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;deleteStudent&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;Integer&quot;</span>&gt;</span><br>        delete from mybatisdb.student where s_id=#&#123;id&#125;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">delete</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h2 id="SpringSecurity"><a href="#SpringSecurity" class="headerlink" title="SpringSecurity"></a>SpringSecurity</h2><p>项目：springboot-06-security</p>
<p>过滤器，拦截器都是安全工具<br>官网：<a target="_blank" rel="noopener" href="https://spring.io/projects/spring-security">https://spring.io/projects/spring-security</a></p>
<p>传统的拦截器过滤器比较冗余复杂s</p>
<p>官网：<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.0.3.RELEASE/reference/htmlsingle/#using-boot-starter">https://docs.spring.io/spring-boot/docs/2.0.3.RELEASE/reference/htmlsingle/#using-boot-starter</a></p>
<p>SpringSecurity是针对Spring项目的安全框架，也是Springboot底层安全模块默认的技术选型，能够实现强大的Web安全控制，使用的时候引入spring-boot-starter-security模块，再进行一些相应配置实现功能。</p>
<ul>
<li>WebSecurityConfigurerAdapter:自定义Security策略</li>
<li>AuthenticationManagerBuilder:自定义认证策略</li>
<li>@EnableWebSecurity:开启WebSecurity模式</li>
</ul>
<p>SpringSecurity的两个目标为认证与授权(访问控制)<br>Authentication:认证<br>Authorization:授权</p>
<p>参考官网: <a target="_blank" rel="noopener" href="https://spring.io/projects/spring-security">https://spring.io/projects/spring-security</a>, 查看我们自己项目中的版本，找到对应的帮助文档:<br><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-security/site/docs/5.2.0.RELEASE/reference/htmlsingle">https://docs.spring.io/spring-security/site/docs/5.2.0.RELEASE/reference/htmlsingle</a></p>
<p>导入依赖：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>在配置文件夹下配置SpringSecurity的配置类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@EnableWebSecurity</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSecurityConfigurerAdapter</span> </span>&#123;<br>    <span class="hljs-comment">//链式编程</span><br>    <span class="hljs-comment">//授权部分</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        <span class="hljs-comment">//首页所有人可以访问，功能也只有堆相应的人开放</span><br>        http.authorizeRequests()<br>                .antMatchers(<span class="hljs-string">&quot;/&quot;</span>).permitAll()<br>                .antMatchers(<span class="hljs-string">&quot;/level1/**&quot;</span>).hasRole(<span class="hljs-string">&quot;vip1&quot;</span>)<br>                .antMatchers(<span class="hljs-string">&quot;/level2/**&quot;</span>).hasRole(<span class="hljs-string">&quot;vip2&quot;</span>)<br>                .antMatchers(<span class="hljs-string">&quot;/level3/**&quot;</span>).hasRole(<span class="hljs-string">&quot;vip3&quot;</span>);<br>        <span class="hljs-comment">//无权限的时候跳到登录</span><br>        http.formLogin();<br>        http.csrf().disable();<span class="hljs-comment">//关闭csrf功能,防止跨站攻击</span><br>        <span class="hljs-comment">//注销,返回首页</span><br>        http.logout().logoutSuccessUrl(<span class="hljs-string">&quot;/&quot;</span>);<br>        <span class="hljs-comment">//开启记住登录用户名、密码功能;其实就是使用cookies实现，默认保存两周时间</span><br>        <span class="hljs-comment">//可以自定义接受前端的参数	</span><br>        http.rememberMe().rememberMeParameter(<span class="hljs-string">&quot;remember&quot;</span>);<br>        http.rememberMe();<br>    &#125;<br>    <span class="hljs-comment">//认证部分</span><br>    <span class="hljs-comment">//密码编码，会进行加密 PasswordEncoder</span><br>    <span class="hljs-comment">//在Spring Security5.0以上新增了许多加密方法</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(AuthenticationManagerBuilder auth)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        auth.inMemoryAuthentication().passwordEncoder(<span class="hljs-keyword">new</span> BCryptPasswordEncoder())<br>                .withUser(<span class="hljs-string">&quot;mao&quot;</span>).password(<span class="hljs-keyword">new</span> BCryptPasswordEncoder().encode(<span class="hljs-string">&quot;root&quot;</span>)).roles(<span class="hljs-string">&quot;vip2&quot;</span>,<span class="hljs-string">&quot;vip1&quot;</span>)<br>                .and()<br>                .withUser(<span class="hljs-string">&quot;admin&quot;</span>).password(<span class="hljs-keyword">new</span> BCryptPasswordEncoder().encode(<span class="hljs-string">&quot;admin&quot;</span>)).roles(<span class="hljs-string">&quot;vip1&quot;</span>,<span class="hljs-string">&quot;vip2&quot;</span>,<span class="hljs-string">&quot;vip3&quot;</span>)<br>                .and()<br>                .withUser(<span class="hljs-string">&quot;vip1&quot;</span>).password(<span class="hljs-keyword">new</span> BCryptPasswordEncoder().encode(<span class="hljs-string">&quot;vip1&quot;</span>)).roles(<span class="hljs-string">&quot;vip1&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>其中密码需要加密,需要使用到PasswordEncoder接口实现的类，下图为实现这些接口的加密方式<br><img src="/2021/10/06/SpringBoot%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/image-20210808171020129.png" alt="image-20210808171020129"></p>
<p>当然也可以使用jdbc关联数据库当中的用户设定权限</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span><br><span class="hljs-keyword">private</span> DataSource dataSource;<br><br><span class="hljs-meta">@Autowired</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configureGlobal</span><span class="hljs-params">(AuthenticationManagerBuilder auth)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>    <span class="hljs-comment">// ensure the passwords are encoded properly</span><br>    UserBuilder users = User.withDefaultPasswordEncoder();<br>    auth<br>        .jdbcAuthentication()<br>            .dataSource(dataSource)<br>            .withDefaultSchema()<br>            .withUser(users.username(<span class="hljs-string">&quot;user&quot;</span>).password(<span class="hljs-string">&quot;password&quot;</span>).roles(<span class="hljs-string">&quot;USER&quot;</span>))<br>            .withUser(users.username(<span class="hljs-string">&quot;admin&quot;</span>).password(<span class="hljs-string">&quot;password&quot;</span>).roles(<span class="hljs-string">&quot;USER&quot;</span>,<span class="hljs-string">&quot;ADMIN&quot;</span>));<br>&#125;<br></code></pre></td></tr></table></figure>

<p>使用thymeleaf与springsecurity共同解决安全问题</p>
<p>导入依赖：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.thymeleaf.extras<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>thymeleaf-extras-springsecurity5<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.0.4.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>结合thymeleaf与springsecurity，在html当中设置只有经过验证的才显示用户名以及注销按钮，并且在未登录时只显示登录；在登录后只显示与当前登录用户相对应的权限等级对应界面</p>
<figure class="highlight html"><table><tr><td class="code"><pre><code class="hljs html"> <span class="hljs-comment">&lt;!--登录注销--&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;right menu&quot;</span>&gt;</span><br>                <span class="hljs-comment">&lt;!--如果未登录--&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">sec:authorize</span>=<span class="hljs-string">&quot;!isAuthenticated()&quot;</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item&quot;</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/toLogin&#125;&quot;</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;address card icon&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> 登录<br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                <span class="hljs-comment">&lt;!--如果登录了显示用户名和注销--&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">sec:authorize</span>=<span class="hljs-string">&quot;isAuthenticated()&quot;</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item&quot;</span>&gt;</span><br>                        用户名: <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">sec:authentication</span>=<span class="hljs-string">&quot;name&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>                        角色: <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">sec:authentication</span>=<span class="hljs-string">&quot;principal.Authorities&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">sec:authorize</span>=<span class="hljs-string">&quot;isAuthenticated()&quot;</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item&quot;</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/logout&#125;&quot;</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;sign-out icon&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> 注销<br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-comment">&lt;!--根据权限角色显示菜单--&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;column&quot;</span> <span class="hljs-attr">sec:authorize</span>=<span class="hljs-string">&quot;hasRole(&#x27;vip1&#x27;)&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ui raised segment&quot;</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ui&quot;</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;content&quot;</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">h5</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;content&quot;</span>&gt;</span>Level 1<span class="hljs-tag">&lt;/<span class="hljs-name">h5</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">hr</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/level1/1&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;bullhorn icon&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> Level-1-1<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/level1/2&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;bullhorn icon&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> Level-1-2<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/level1/3&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;bullhorn icon&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> Level-1-3<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h2 id="Shiro"><a href="#Shiro" class="headerlink" title="Shiro"></a>Shiro</h2><ul>
<li>Apache Shiro是一个java的安全框架</li>
<li>Shiro可以非常容易开发出足够好的应用，其不仅可以用在javaSE环境，也可以用在javaEE环境</li>
<li>Shiro可以完成认证、授权、加密、会话管理、Web集成、缓存等等</li>
<li>官网下载地址：<a target="_blank" rel="noopener" href="http://shiro.apache.org/">http://shiro.apache.org/</a></li>
</ul>
<p><img src="/2021/10/06/SpringBoot%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/image-20210808223316124.png" alt="image-20210808223316124"></p>
<p><strong>架构</strong></p>
<p>==外部角度==：从应用程序角度来观察如何使用shiro完成工作：</p>
<p><img src="/2021/10/06/SpringBoot%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/image-20210808223548277.png" alt="image-20210808223548277"></p>
<ul>
<li><p>subject:应用代码直接交互的对象是Subject, 也就是说Shiro的对外API核心就是Subject, Subject代表了当前的用户，这个用户不一定是一个具体的人，与当前应用交互的任何东西都是Subject,如网络爬虫，机器人<br>等，与Subject的所有交互都会委托给SecurityManager; Subject其实是 一个门面， SecurityManageer 才是实际的执行者</p>
</li>
<li><p>SecurityManager:安全管理器，即所有与安全有关的操作都会与SercurityManager交互，并且它管理着所有的Subject,可以看出它是Shiro的核心，它负责与Shiro的其他组件进行交互，它相当于SpringMVC的DispatcherServlet的角色</p>
</li>
<li><p>Realm: Shiro从Realm获取安全数据 (如用户，角色，权限) ,就是说SecurityManager 要验证用户身份，那么它需要从Realm获取相应的用户进行比较,来确定用户的身份是否合法;也需要从Realm得到用户相应的角色、权限，进行验证用户的操作是否能够进行，可以把Realm看成DataSource;</p>
</li>
</ul>
<p>==内部角度==</p>
<p><img src="/2021/10/06/SpringBoot%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/image-20210808223856428.png" alt="image-20210808223856428"></p>
<ul>
<li>Subject:任何可以与应用交互的用户</li>
<li>Security Manager:相当于SpringMVC中的DispatcherServlet; 是Shiro的心脏,所有具体的交互都通过Security Manager进行控制，它管理者所有的Subject,且负责进行认证，授权，会话，及缓存的管理。</li>
<li>Authenticator:负责Subject认证，是一一个扩展点，可以自定义实现;可以使用认证策略(AuthenticationStrategy),即什么情况下算用户认证通过了;</li>
<li>Authorizer:授权器，即访问控制器，用来决定主体是否有权限进行相应的操作;即控制着用户能访问应用中的那些功能;</li>
<li>Realm:可以有一个或者多个的realm,可以认为是安全实体数据源，即用于获取安全实体的，可以用JDBC实现，也可以是内存实现等等，由用户提供;所以一般在应用中都需要实现自己的realm</li>
<li>SessionManager:管理Session生命周期的组件，而Shiro并不仅仅可以用在Web环境，也可以用在普通的JavaSE环境中</li>
<li>CacheManager:缓存控制器，来管理如用户，角色，权限等缓存的;因为这些数据基本上很少改变,放到缓存中后可以提高访问的性能;</li>
<li>Cryptography:密码模块，Shiro 提高了一些常见的加密组件用于密码加密，解密等</li>
</ul>
<p>==hello-shiro项目==<a target="_blank" rel="noopener" href="https://github.com/apache/shiro/tree/master/samples">https://github.com/apache/shiro/tree/master/samples</a></p>
<p>1.导入依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.shiro<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>shiro-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.4.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>        <span class="hljs-comment">&lt;!-- configure logging --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jcl-over-slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.7.21<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>slf4j-log4j12<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.7.21<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>log4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>log4j<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.17<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>2.配置文件<br>3.quickstart</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.apache.shiro.SecurityUtils;<br><span class="hljs-keyword">import</span> org.apache.shiro.authc.*;<br><br><span class="hljs-keyword">import</span> org.apache.shiro.config.IniSecurityManagerFactory;<br><span class="hljs-keyword">import</span> org.apache.shiro.mgt.SecurityManager;<br><span class="hljs-keyword">import</span> org.apache.shiro.session.Session;<br><span class="hljs-keyword">import</span> org.apache.shiro.subject.Subject;<br><span class="hljs-keyword">import</span> org.apache.shiro.util.Factory;<br><span class="hljs-keyword">import</span> org.slf4j.Logger;<br><span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Quickstart</span> </span>&#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">transient</span> Logger log = LoggerFactory.getLogger(Quickstart.class);<br><br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        <span class="hljs-comment">//使用配置好的ini文件创建SecurityManager实例</span><br>        Factory&lt;SecurityManager&gt; factory = <span class="hljs-keyword">new</span> IniSecurityManagerFactory(<span class="hljs-string">&quot;classpath:shiro.ini&quot;</span>);<br>        SecurityManager securityManager = factory.getInstance();<br><br>        SecurityUtils.setSecurityManager(securityManager);<br><br>        <span class="hljs-comment">//获取当前用户对象</span><br>        Subject currentUser = SecurityUtils.getSubject();<br><br>        <span class="hljs-comment">//通过当前用户拿到session</span><br>        Session session = currentUser.getSession();<br>        <span class="hljs-comment">//拿到后取相应的值</span><br>        session.setAttribute(<span class="hljs-string">&quot;someKey&quot;</span>, <span class="hljs-string">&quot;aValue&quot;</span>);<br>        String value = (String) session.getAttribute(<span class="hljs-string">&quot;someKey&quot;</span>);<br>        <span class="hljs-keyword">if</span> (value.equals(<span class="hljs-string">&quot;aValue&quot;</span>)) &#123;<br>            log.info(<span class="hljs-string">&quot;Retrieved the correct value: Subject=&gt;session! [&quot;</span> + value + <span class="hljs-string">&quot;]&quot;</span>);<br>        &#125;<br>        <span class="hljs-comment">//判断当前用户是否被认证</span><br>        <span class="hljs-keyword">if</span> (!currentUser.isAuthenticated()) &#123;<br>            <span class="hljs-comment">//根据登录生成令牌</span><br>            UsernamePasswordToken token = <span class="hljs-keyword">new</span> UsernamePasswordToken(<span class="hljs-string">&quot;lonestarr&quot;</span>, <span class="hljs-string">&quot;vespa&quot;</span>);<br>            <span class="hljs-comment">//设置记住我</span><br>            token.setRememberMe(<span class="hljs-keyword">true</span>);<br>            <span class="hljs-keyword">try</span> &#123;<br>                currentUser.login(token);<span class="hljs-comment">//执行登录操作</span><br>            &#125; <span class="hljs-keyword">catch</span> (UnknownAccountException uae) &#123;<br>                log.info(<span class="hljs-string">&quot;There is no user with username of &quot;</span> + token.getPrincipal());<br>            &#125; <span class="hljs-keyword">catch</span> (IncorrectCredentialsException ice) &#123;<br>                log.info(<span class="hljs-string">&quot;Password for account &quot;</span> + token.getPrincipal() + <span class="hljs-string">&quot; was incorrect!&quot;</span>);<br>            &#125; <span class="hljs-keyword">catch</span> (LockedAccountException lae) &#123;<br>                log.info(<span class="hljs-string">&quot;The account for username &quot;</span> + token.getPrincipal() + <span class="hljs-string">&quot; is locked.  &quot;</span> +<br>                        <span class="hljs-string">&quot;Please contact your administrator to unlock it.&quot;</span>);<br>            &#125;<br>            <span class="hljs-keyword">catch</span> (AuthenticationException ae) &#123;<br>                <span class="hljs-comment">//unexpected condition?  error?</span><br>            &#125;<br>        &#125;<br><br>        log.info(<span class="hljs-string">&quot;User [&quot;</span> + currentUser.getPrincipal() + <span class="hljs-string">&quot;] logged in successfully.&quot;</span>);<br>        <span class="hljs-comment">//测试角色</span><br>        <span class="hljs-keyword">if</span> (currentUser.hasRole(<span class="hljs-string">&quot;schwartz&quot;</span>)) &#123;<br>            log.info(<span class="hljs-string">&quot;May the Schwartz be with you!&quot;</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            log.info(<span class="hljs-string">&quot;Hello, mere mortal.&quot;</span>);<br>        &#125;<br>        <span class="hljs-comment">//粗粒度的</span><br>        <span class="hljs-keyword">if</span> (currentUser.isPermitted(<span class="hljs-string">&quot;lightsaber:wield&quot;</span>)) &#123;<br>            log.info(<span class="hljs-string">&quot;You may use a lightsaber ring.  Use it wisely.&quot;</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            log.info(<span class="hljs-string">&quot;Sorry, lightsaber rings are for schwartz masters only.&quot;</span>);<br>        &#125;<br>        <span class="hljs-comment">//细粒度的</span><br>        <span class="hljs-keyword">if</span> (currentUser.isPermitted(<span class="hljs-string">&quot;winnebago:drive:eagle5&quot;</span>)) &#123;<br>            log.info(<span class="hljs-string">&quot;You are permitted to &#x27;drive&#x27; the winnebago with license plate (id) &#x27;eagle5&#x27;.  &quot;</span> +<br>                    <span class="hljs-string">&quot;Here are the keys - have fun!&quot;</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            log.info(<span class="hljs-string">&quot;Sorry, you aren&#x27;t allowed to drive the &#x27;eagle5&#x27; winnebago!&quot;</span>);<br>        &#125;<br>        currentUser.logout();<span class="hljs-comment">//注销</span><br><br>        System.exit(<span class="hljs-number">0</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>详细代码可以看springboot-08-shiro项目下的子项目hello-shiro</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//关键的点</span><br><span class="hljs-comment">//获取当前用户对象</span><br>Subject currentUser = SecurityUtils.getSubject();<br><span class="hljs-comment">//通过当前用户拿到session</span><br>Session session = currentUser.getSession();<br><span class="hljs-comment">//判断当前用户是否被认证</span><br>currentUser.isAuthenticated();<br><span class="hljs-comment">//获得当前用户的认证</span><br>currentUser.getPrincipal();<br><span class="hljs-comment">//当前用户是否用有该角色</span><br>currentUser.hasRole(<span class="hljs-string">&quot;schwartz&quot;</span>);<br><span class="hljs-comment">//获得当前用户的权限</span><br>currentUser.isPermitted(<span class="hljs-string">&quot;lightsaber:wield&quot;</span>);<br><span class="hljs-comment">//注销</span><br>currentUser.logout();<br></code></pre></td></tr></table></figure>

<p><strong>springboot集成shiro</strong></p>
<p>完整代码：springboot-08-shiro项目下的子项目shiro-springboot</p>
<p>1.导入依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">       Subject 用户</span><br><span class="hljs-comment">       SecurityManager 管理所有用户</span><br><span class="hljs-comment">       Realm 连接数据</span><br><span class="hljs-comment">       --&gt;</span><br>       <span class="hljs-comment">&lt;!--Spring shiro的整合包--&gt;</span><br>       <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.shiro<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>shiro-spring<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.4.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>       <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>2.编写授权认证以及shiro配置</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserRealm</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AuthorizingRealm</span> </span>&#123;<br>    <span class="hljs-comment">//授权</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> AuthorizationInfo <span class="hljs-title">doGetAuthorizationInfo</span><span class="hljs-params">(PrincipalCollection principalCollection)</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;执行了=》授权doGetAuthorizationInfo&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>    &#125;<br>    <span class="hljs-comment">//认证，登录的时候就会执行这里的方法，这是一个全局的方法，能够获得当前登录的token</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> AuthenticationInfo <span class="hljs-title">doGetAuthenticationInfo</span><span class="hljs-params">(AuthenticationToken authenticationToken)</span> <span class="hljs-keyword">throws</span> AuthenticationException </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;执行了=》认证doGetAuthenticationInfo&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ShiroConfig</span> </span>&#123;<br>    <span class="hljs-comment">//ShiroFilterFactoryBean</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> ShiroFilterFactoryBean <span class="hljs-title">getShiroFilterFactoryBean</span><span class="hljs-params">(<span class="hljs-meta">@Qualifier(&quot;securityManager&quot;)</span> DefaultWebSecurityManager defaultWebSecurityManager)</span></span>&#123;<br>        ShiroFilterFactoryBean bean = <span class="hljs-keyword">new</span> ShiroFilterFactoryBean();<br>        <span class="hljs-comment">//设置安全管理器</span><br>        bean.setSecurityManager(defaultWebSecurityManager);<br>        <span class="hljs-keyword">return</span> bean;<br>    &#125;<br><br>    <span class="hljs-comment">//DefaultWebSecurityManager</span><br>    <span class="hljs-meta">@Bean(&quot;securityManager&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> DefaultWebSecurityManager <span class="hljs-title">getDefaultWebSecurityManager</span><span class="hljs-params">(<span class="hljs-meta">@Qualifier(&quot;userRealm&quot;)</span> UserRealm userRealm)</span></span>&#123;<br>        DefaultWebSecurityManager securityManager = <span class="hljs-keyword">new</span> DefaultWebSecurityManager();<br>        securityManager.setRealm(userRealm);<br><br>        <span class="hljs-keyword">return</span> securityManager;<br>    &#125;<br><br>    <span class="hljs-comment">//创建realm对象，自定义类</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> UserRealm <span class="hljs-title">userRealm</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> UserRealm();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>设置拦截逻辑</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> ShiroFilterFactoryBean <span class="hljs-title">getShiroFilterFactoryBean</span><span class="hljs-params">(<span class="hljs-meta">@Qualifier(&quot;securityManager&quot;)</span> DefaultWebSecurityManager defaultWebSecurityManager)</span></span>&#123;<br>       ShiroFilterFactoryBean bean = <span class="hljs-keyword">new</span> ShiroFilterFactoryBean();<br>       <span class="hljs-comment">//设置安全管理器</span><br>       bean.setSecurityManager(defaultWebSecurityManager);<br>       <span class="hljs-comment">/**</span><br><span class="hljs-comment">        anon:无需认证就可以访问</span><br><span class="hljs-comment">        authc:必须认证才能访问</span><br><span class="hljs-comment">        user:必须拥有记住我功能才能访问</span><br><span class="hljs-comment">        perms:拥有对某个资源的权限才能访问</span><br><span class="hljs-comment">        role:拥有某个角色权限才能访问</span><br><span class="hljs-comment">        **/</span><br>       Map&lt;String, String&gt; filterChainDefinitionMap = <span class="hljs-keyword">new</span> LinkedHashMap&lt;&gt;();<br>       <span class="hljs-comment">//设置拦截界面</span><br>       filterChainDefinitionMap.put(<span class="hljs-string">&quot;/user/add&quot;</span>, <span class="hljs-string">&quot;authc&quot;</span>);<br>       filterChainDefinitionMap.put(<span class="hljs-string">&quot;/user/update&quot;</span>, <span class="hljs-string">&quot;authc&quot;</span>);<br>       bean.setFilterChainDefinitionMap(filterChainDefinitionMap);<br>       <span class="hljs-comment">//设置登录的请求</span><br>       bean.setLoginUrl(<span class="hljs-string">&quot;/toLogin&quot;</span>);<br>       <span class="hljs-keyword">return</span> bean;<br>   &#125;<br></code></pre></td></tr></table></figure>

<p>增加相应的认证逻辑</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//认证，登录的时候就会执行这里的方法，这是一个全局的方法，能够获得当前登录的token</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> AuthenticationInfo <span class="hljs-title">doGetAuthenticationInfo</span><span class="hljs-params">(AuthenticationToken authenticationToken)</span> <span class="hljs-keyword">throws</span> AuthenticationException </span>&#123;<br><br>        System.out.println(<span class="hljs-string">&quot;执行了=》认证doGetAuthenticationInfo&quot;</span>);<br>        <span class="hljs-comment">//用户名，密码，可以从数据库关联</span><br>        String name = <span class="hljs-string">&quot;root&quot;</span>;<br>        String password = <span class="hljs-string">&quot;root&quot;</span>;<br>        UsernamePasswordToken userToken = (UsernamePasswordToken) authenticationToken;<br>        <span class="hljs-keyword">if</span> (!userToken.getUsername().equals(name)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<span class="hljs-comment">//抛出异常 UnknownAccountException</span><br>        &#125;<br>        <span class="hljs-comment">//密码认证shiro自动完成</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> SimpleAuthenticationInfo(<span class="hljs-string">&quot;&quot;</span>,password,<span class="hljs-string">&quot;&quot;</span>);<br>    &#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/login&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">login</span><span class="hljs-params">(String username, String password, Model model)</span></span>&#123;<br>        <span class="hljs-comment">//获取当前用户</span><br>        Subject subject = SecurityUtils.getSubject();<br>        <span class="hljs-comment">//封装用户的登陆数据</span><br>        UsernamePasswordToken token = <span class="hljs-keyword">new</span> UsernamePasswordToken(username, password);<br>        <span class="hljs-keyword">try</span> &#123;<br>            subject.login(token);<span class="hljs-comment">//执行登录方法,会调用认证逻辑doGetAuthenticationInfo方法</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;index&quot;</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (UnknownAccountException e) &#123;<br>            model.addAttribute(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;用户名不存在&quot;</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;login&quot;</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (IncorrectCredentialsException e) &#123;<br>            model.addAttribute(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;密码错误&quot;</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;login&quot;</span>;<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure>

<p>整合mybatis查询数据库当中的用户验证身份</p>
<p>详细代码：springboot-08-shiro项目下的子项目shiro-springboot</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserRealm</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AuthorizingRealm</span> </span>&#123;<br>    <span class="hljs-meta">@Autowired</span><br>    UserServiceImpl userService;<br>    <span class="hljs-comment">//授权</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> AuthorizationInfo <span class="hljs-title">doGetAuthorizationInfo</span><span class="hljs-params">(PrincipalCollection principalCollection)</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;执行了=》授权doGetAuthorizationInfo&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>    &#125;<br>    <span class="hljs-comment">//认证，登录的时候就会执行这里的方法，这是一个全局的方法，能够获得当前登录的token</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> AuthenticationInfo <span class="hljs-title">doGetAuthenticationInfo</span><span class="hljs-params">(AuthenticationToken authenticationToken)</span> <span class="hljs-keyword">throws</span> AuthenticationException </span>&#123;<br><br>        System.out.println(<span class="hljs-string">&quot;执行了=》认证doGetAuthenticationInfo&quot;</span>);<br>        <span class="hljs-comment">//用户名，密码，可以从数据库关联</span><br>        UsernamePasswordToken userToken = (UsernamePasswordToken) authenticationToken;<br>        User user = userService.queryUserByName(userToken.getUsername());<br>        <span class="hljs-keyword">if</span> (user == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<span class="hljs-comment">//抛出异常 UnknownAccountException</span><br>        <span class="hljs-comment">//密码认证shiro自动完成,也可以进行加密</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> SimpleAuthenticationInfo(<span class="hljs-string">&quot;&quot;</span>,user.getPassword(),<span class="hljs-string">&quot;&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>shiro也可以对密码加密，加密方法如下，默认为SimpleCredentialsMatcher</p>
<p><img src="/2021/10/06/SpringBoot%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/image-20210809205602493.png"></p>
<p><strong>整合ShiroDialect</strong></p>
<p>详细代码：springboot-08-shiro项目下的子项目shiro-springboot</p>
<p>1.导入依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.github.theborakompanioni<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>thymeleaf-extras-shiro<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>2.写配置类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//整合ShiroDialect，用于整合shiro thymeleaf</span><br><span class="hljs-meta">@Bean</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> ShiroDialect <span class="hljs-title">getShiroDialect</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ShiroDialect();<br>&#125;<br></code></pre></td></tr></table></figure>

<p>3.html文件写一些页面可见条件</p>
<figure class="highlight html"><table><tr><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>首页<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">th:if</span>=<span class="hljs-string">&quot;$&#123;session.loginUser==null&#125;&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/toLogin&#125;&quot;</span>&gt;</span>登录<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;msg&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">hr</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">shiro:hasPermission</span>=<span class="hljs-string">&quot;111&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/user/add&#125;&quot;</span>&gt;</span>add<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">shiro:hasPermission</span>=<span class="hljs-string">&quot;222&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/user/update&#125;&quot;</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h2 id="Swagger简介"><a href="#Swagger简介" class="headerlink" title="Swagger简介"></a>Swagger简介</h2><ul>
<li>世界上最流行的API框架</li>
<li>Restful API文档在线自动生成工具：API文档与API定义同步更新</li>
<li>直接运行，可以在线测试API接口</li>
</ul>
<p>官网：<a target="_blank" rel="noopener" href="https://swagger.io/">https://swagger.io/</a></p>
<p>项目中使用Swagger需要Springbox,包含两部分东西：</p>
<ul>
<li>swagger2</li>
<li>swagger-ui</li>
</ul>
<p><strong>==springboot集成Swagger==</strong></p>
<p>1.新建一个springboot项目，详细见springboot-swagger</p>
<p>2.导入依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/io.springfox/springfox-swagger2 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.springfox<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springfox-swagger2<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.9.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/io.springfox/springfox-swagger-ui --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.springfox<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.9.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>3.编写一个测试工程hello</p>
<p>4.配置Swagger,和之前一样在config包下创建一个SwaggerConfig文件用于配置</p>
<p>5.测试运行</p>
<p>配置swagger:swagger有一个bean实例Docket;</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@EnableSwagger2</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SwaggerConfig</span> </span>&#123;<br>    <span class="hljs-comment">//配置swagger的bean实例</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Docket <span class="hljs-title">docket</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Docket(DocumentationType.SWAGGER_2)<br>                .apiInfo();<br>    &#125;<br>    <span class="hljs-comment">//作者信息</span><br>    Contact contact = <span class="hljs-keyword">new</span> Contact(<span class="hljs-string">&quot;mao&quot;</span>,<span class="hljs-string">&quot;https://www.baidu.com&quot;</span>,<span class="hljs-string">&quot;2128633651@qq.com&quot;</span>);<br>    <span class="hljs-comment">//配置Swagger信息=apiInfo   DEFAULT_CONTACT</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> ApiInfo <span class="hljs-title">apiInfo</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ApiInfo(<br>                <span class="hljs-string">&quot;我的SwaggerAPI文档日志&quot;</span>,<br>                <span class="hljs-string">&quot;一花一世界，彧火重生&quot;</span>,<br>                <span class="hljs-string">&quot;1.0&quot;</span>,<br>                <span class="hljs-string">&quot;https://www.baidu.com&quot;</span>,<br>                contact,<br>                <span class="hljs-string">&quot;Apache 2.0&quot;</span>,<br>                <span class="hljs-string">&quot;http://www.apache.org/licenses/LICENSE-2.0&quot;</span>,<br>                <span class="hljs-keyword">new</span> ArrayList());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>swagger配置扫描接口</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//配置swagger的bean实例</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Docket <span class="hljs-title">docket</span><span class="hljs-params">(Environment environment)</span></span>&#123;<br>        <span class="hljs-comment">//设置要显示的swagger环境</span><br>        Profiles profiles = Profiles.of(<span class="hljs-string">&quot;dev&quot;</span>,<span class="hljs-string">&quot;test&quot;</span>);<br>        <span class="hljs-comment">//通过acceptsProfiles监听当前是否处在设定的环境，获取项目的环境</span><br>        <span class="hljs-keyword">boolean</span> flag = environment.acceptsProfiles(profiles);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Docket(DocumentationType.SWAGGER_2)<br>                .apiInfo(apiInfo())<br>                <span class="hljs-comment">//是否启用swagger</span><br>                .enable(flag)<br>                .select()<br>                <span class="hljs-comment">//RequestHandlerSelectors,配置需要扫描接口的方式</span><br>                <span class="hljs-comment">//basePackage指定需要扫描的包</span><br>                <span class="hljs-comment">//any()扫描全部  none()都不扫描</span><br>                <span class="hljs-comment">// withClassAnnotation:扫描类上的注解,参数为一个注解的反射对象</span><br>                <span class="hljs-comment">// withMethodAnnotation:扫描方法上的注解</span><br>                .apis(RequestHandlerSelectors.basePackage(<span class="hljs-string">&quot;com.mao.swagger.controller&quot;</span>))<br>                <span class="hljs-comment">//过滤一些路径,只扫描/mao/下的路径</span><br>                .paths(PathSelectors.ant(<span class="hljs-string">&quot;/mao/**&quot;</span>))<br>                .build();<br>    &#125;<br></code></pre></td></tr></table></figure>

<p>配置API的分组</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java">.groupName(<span class="hljs-string">&quot;my test2 Group&quot;</span>)<br></code></pre></td></tr></table></figure>

<p>配置多个分组，使用多个Docket实例实现即可</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> Docket <span class="hljs-title">docket1</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Docket(DocumentationType.SWAGGER_2).groupName(<span class="hljs-string">&quot;My test2 API Group&quot;</span>);<br>&#125;<br><br><span class="hljs-meta">@Bean</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> Docket <span class="hljs-title">docket2</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Docket(DocumentationType.SWAGGER_2).groupName(<span class="hljs-string">&quot;My test3 API Group&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>swagger测试功能</strong>(类似postman)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ApiOperation(&quot;给这个接口加一个注释&quot;)</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloController</span> </span>&#123;<br>    <span class="hljs-meta">@GetMapping(&quot;/hello&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">hello</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-comment">//只要我们的接口当中返回值存在实体类，就会被扫描到swagger当中</span><br>    <span class="hljs-meta">@ApiOperation(&quot;用户接口&quot;)</span><span class="hljs-comment">//给这个接口加一个注释</span><br>    <span class="hljs-meta">@PostMapping(&quot;/user&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">user</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> User();<br>    &#125;<br><br>    <span class="hljs-meta">@ApiOperation(&quot;Post测试类&quot;)</span><br>    <span class="hljs-meta">@GetMapping(value = &quot;/posttest&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">post_test</span><span class="hljs-params">(<span class="hljs-meta">@ApiParam(&quot;用户&quot;)</span>User user)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> user;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>总结：</strong></p>
<p>1.可以通过Swagger给一些比较难理解的@ApiModelProperty属性或者@ApiOperation接口增加相应的注释信息</p>
<p>2.接口文档实时更新</p>
<p>3.可以做一些在线测试</p>
<h2 id="任务"><a href="#任务" class="headerlink" title="任务"></a>任务</h2><p>项目源码详见：springboot-09-asyc</p>
<p><strong>异步任务</strong></p>
<p>1.开启注解</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-meta">@EnableAsync</span><span class="hljs-comment">//开启异步注解功能</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Springboot09AsycApplication</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>     SpringApplication.run(Springboot09AsycApplication.class, args);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p>2.给需要开启异步的方法添加注解</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AsyncService</span> </span>&#123;<br>    <span class="hljs-comment">//通过注解设为一个异步方法,使得service里的hello方法的业务处理开启另一个线程执行</span><br>    <span class="hljs-meta">@Async</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">hello</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            Thread.sleep(<span class="hljs-number">3000</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        System.out.println(<span class="hljs-string">&quot;数据正在处理当中&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>邮件任务</strong></p>
<p>1.导入依赖</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java">&lt;dependency&gt;<br>    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>    &lt;artifactId&gt;spring-boot-starter-mail&lt;/artifactId&gt;<br>&lt;/dependency&gt;<br></code></pre></td></tr></table></figure>

<p>2.编写配置</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml">spring.mail.username=3128633651@qq.com<br>spring.mail.password=<br># 发送的服务器<br>spring.mail.host=smtp.qq.com<br># 开启加密验证<br>spring.mail.properties.mail.smtl.ssl.enable=true<br></code></pre></td></tr></table></figure>

<p>3.测试</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span><br>JavaMailSenderImpl mailSender;<span class="hljs-comment">//注入邮件发送的实现类</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">contextLoads</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-comment">//创建一个邮件</span><br>    SimpleMailMessage mailMessage = <span class="hljs-keyword">new</span> SimpleMailMessage();<br>    mailMessage.setSubject(<span class="hljs-string">&quot;test 邮件&quot;</span>);<br>    mailMessage.setText(<span class="hljs-string">&quot;这是邮件的内容- _ -&quot;</span>);<br>    mailMessage.setTo(<span class="hljs-string">&quot;3128633651@qq.com&quot;</span>);<span class="hljs-comment">//从服务器获取</span><br>    mailMessage.setFrom(<span class="hljs-string">&quot;3128633651@qq.com&quot;</span>);<span class="hljs-comment">//服务器接收</span><br><br>    mailSender.send(mailMessage);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>自己写一个发送邮件的工具类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MailUtil</span> </span>&#123;<br>    <span class="hljs-meta">@Autowired</span><br>    JavaMailSenderImpl mailSender;<span class="hljs-comment">//注入邮件发送的实现类</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">send</span><span class="hljs-params">(Boolean html, String suject, String text)</span> <span class="hljs-keyword">throws</span> MessagingException </span>&#123;<br>        <span class="hljs-comment">//创建一个复杂邮件</span><br>        MimeMessage mimeMessage = mailSender.createMimeMessage();<br>        <span class="hljs-comment">//组装</span><br>        MimeMessageHelper helper = <span class="hljs-keyword">new</span> MimeMessageHelper(mimeMessage, <span class="hljs-keyword">true</span>);<br>        <span class="hljs-comment">//正文</span><br>        helper.setSubject(suject);<br>        helper.setText(<span class="hljs-string">&quot;&lt;p style=&#x27;color:blue&#x27;&gt;html标题&lt;/p&gt;&quot;</span>, html);<br>        <span class="hljs-comment">//附件</span><br>        helper.addAttachment(<span class="hljs-string">&quot;1.jpg&quot;</span>,<span class="hljs-keyword">new</span> File(<span class="hljs-string">&quot;E:\\研二上\\笔记整理\\image\\image-20210729235254848.png&quot;</span>));<br><br>        helper.setTo(<span class="hljs-string">&quot;3128633651@qq.com&quot;</span>);<span class="hljs-comment">//从服务器获取</span><br>        helper.setFrom(<span class="hljs-string">&quot;3128633651@qq.com&quot;</span>);<span class="hljs-comment">//服务器接收</span><br>        mailSender.send(mimeMessage);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>定时任务</strong></p>
<p>TaskScheduler:任务调度者<br>TaskExecutor:任务执行者<br>@EnableScheduling:开启定时功能的注解<br>@Scheduled:什么时候执行</p>
<p>Cron表达式</p>
<p>工具接口网址：<a target="_blank" rel="noopener" href="https://cron.qqe2.com/">https://cron.qqe2.com/</a></p>
<h2 id="Springboot整合redis"><a href="#Springboot整合redis" class="headerlink" title="Springboot整合redis"></a>Springboot整合redis</h2><p>补充：源码分析</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br><span class="hljs-meta">@ConditionalonMissingBean(name = &quot;redisTemplate&quot;)</span> <span class="hljs-comment">// 我们可以自己定义一个redi sTemp late来替换这个默认的!</span><br><span class="hljs-function">pub1ic RedisTemplate&lt;object, object&gt; <span class="hljs-title">redisTemplate</span> <span class="hljs-params">(Redi sConnectionFactory redisConnectionFactory)</span></span><br><span class="hljs-function"><span class="hljs-keyword">throws</span> UnknownHostException </span>&#123;<br><span class="hljs-comment">//默认的RedisTemplate 没有过多的设置，redis 对象都是需要序列化!</span><br><span class="hljs-comment">//两个泛型都是object, object 的类型，我们后使用需要强制转换&lt;string, object&gt;</span><br>RedisTemplate&lt;object, object&gt; template = <span class="hljs-keyword">new</span> RedisTemplate&lt;&gt; ();<br>template.setConnectionFactory(redisConnectionFactory);<br><span class="hljs-keyword">return</span> template ;<br>&#125;<br><span class="hljs-meta">@Bean</span><br><span class="hljs-meta">@ConditionalonMissingBean</span><br><span class="hljs-comment">//由于string 是redis中最常使用的类型，所以说单独提出来一个bean</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> StringRedisTemplate <span class="hljs-title">stringRedisTemplate</span> <span class="hljs-params">(Redi sConnectionFactoryredisConnectionFactory)</span></span><br><span class="hljs-function"><span class="hljs-keyword">throws</span> UnknownHostException </span>&#123;<br>stringRedisTemplate template = <span class="hljs-keyword">new</span> stringRedisTemplate();<br>template.setconnectionFactory(redisConnectionFactory);<br><span class="hljs-keyword">return</span> template;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="分布式"><a href="#分布式" class="headerlink" title="分布式"></a>分布式</h2><p>分布式系统是由一-组通过网络进行通信、为了完成共同的任务而协调工作的计算机节点组成的系统。分布式系统的出现是为 了用廉价的、普通的机器完成单个计算机无法完成的计算、存储任务。其目的是利用更多的机器，处理更多的数据。</p>
<p><strong>dubbo</strong></p>
<p>官网地址：<a target="_blank" rel="noopener" href="https://dubbo.apache.org/zh/docs/quick-start/">https://dubbo.apache.org/zh/docs/quick-start/</a></p>
<p>系统设计的发展</p>
<p><img src="/2021/10/06/SpringBoot%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/image-20210811215531719.png" alt="image-20210811215531719"></p>
<p><img src="/2021/10/06/SpringBoot%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/image-20210811215305918.png" alt="image-20210811215305918"></p>
<p><img src="/2021/10/06/SpringBoot%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/image-20210811215614220.png" alt="image-20210811215614220"></p>
<p><img src="/2021/10/06/SpringBoot%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/image-20210811215632174.png" alt="image-20210811215632174"></p>
<p><img src="/2021/10/06/SpringBoot%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/image-20210811215654652.png" alt="image-20210811215654652"></p>
<p><strong>RPC</strong></p>
<p>RPC [Remote Procedure Call]是指远程过程调用，是一种进程间通信方式，是一种技术的思想，而不是规范。它允许程序调用另一个地址空间(通常是共享网络的另一台机器上)的过程或函数，而不用程序员显式编码这个远程调用的细节。即程序员无论是调用本地的还是远程的函数，本质上编写的调用代码基本相同。<br>也就是说两台服务器A，B,一个应用部署在A服务器上，想要调用B服务器上应用提供的函数/方法，由于不在一个内存空间，不能直接调用，需要通过网络来表达调用的语义和传达调用的数据。为什么要用RPC呢?就是无法在一个进程内， 甚至一个计算机内通过本地调用的方式完成的需求，比如不同的系统间的通讯，甚至不同的组织间的通讯，由于计算能力需要横向扩展，需要在多台机器组成的集群上部署应用。RPC就是要像调用本地的函数一样去调远程函数:<br>推荐文章: <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/2accc2840a1b">https://www.jianshu.com/p/2accc2840a1b</a></p>
<p><img src="/2021/10/06/SpringBoot%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/image-20210811220247820.png" alt="image-20210811220247820"></p>
<p>RPC两个核心模块：通讯、序列化</p>
<p><img src="/2021/10/06/SpringBoot%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/image-20210811220343988.png" alt="image-20210811220343988"></p>
<p>==dubbo==就是一款高性能、轻量级的开源Java RPC框架，提供了三大核心功能：面向接口的远程方法调用，智能容错和负载均衡，以及服务自动注册和发现</p>
<p><img src="/2021/10/06/SpringBoot%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/image-20210811230646406.png" alt="image-20210811230646406"></p>
<p><strong>服务提供者</strong>(Provider) :暴露服务的服务提供方，服务提供者在启动时，向注册中心注册自己提供的服务。<br><strong>服务消费者</strong>(Consumer) : 调用远程服务的服务消费方，服务消费者在启动时，向注册中心订阅自己所需的服务，服务消费者，从提供者地址列表中，基于软负载均衡算法，选一台提供者进行调用，如果调用失败，再选另一台调用。<br><strong>注册中心</strong>(Registry) :注册中心返回服务提供者地址列表给消费者，如果有变更，注册中心将基于长连接推送变更数据给消费者<br><strong>监控中心</strong>(Monitor) :服务消费者和提供者，在内存中累计调用次数和调用时间，定时每分钟发送一次统计数据到监控中心</p>
<p>zookeeper下载网址：<a target="_blank" rel="noopener" href="http://archive.apache.org/dist/zookeeper/">http://archive.apache.org/dist/zookeeper/</a></p>
<p><img src="/2021/10/06/SpringBoot%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/image-20210811234139311.png" alt="image-20210811234139311"></p>
<p><img src="/2021/10/06/SpringBoot%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/image-20210811235018815.png" alt="image-20210811235018815"></p>
<p>查看节点</p>
<p><img src="/2021/10/06/SpringBoot%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/image-20210811234854594.png"></p>
<p>安装dubbo-admin(一个监控管理后台，查看注册了哪些服务)</p>
<p>下载地址：<a target="_blank" rel="noopener" href="https://github.com/apache/dubbo-admin/tree/master">https://github.com/apache/dubbo-admin/tree/master</a></p>
<p>下载后使用maven打包：<br>在项目目录下执行：mvn clean package -Dmaven.test.skip=true<br>注意：最好使用阿里镜像</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mirror</span>&gt;</span>  <br>  <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>alimaven<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>  <br>  <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>aliyun maven<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>  <br>  <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public/<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span>;  <br>  <span class="hljs-tag">&lt;<span class="hljs-name">mirrorOf</span>&gt;</span>central<span class="hljs-tag">&lt;/<span class="hljs-name">mirrorOf</span>&gt;</span>          <br><span class="hljs-tag">&lt;/<span class="hljs-name">mirror</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>打开zookeeper的server.cmd，执行打好的jar包，网页访问<a target="_blank" rel="noopener" href="http://localhost:7001/">http://localhost:7001/</a> 登录账号密码root - root</p>
<h2 id="springboot整合dubbo"><a href="#springboot整合dubbo" class="headerlink" title="springboot整合dubbo"></a>springboot整合dubbo</h2><p>详细代码见：dubbo+zookeeper，里面有两个模块分别为provider和consumer</p>
<p>步骤：</p>
<p>前提：zookeeper服务开启</p>
<ul>
<li><p>提供者提供服务</p>
<p>1.导入依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--提供方导入依赖:Dubbo--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.dubbo<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>dubbo-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.7.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--ZkClient--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.github.sgroschupf<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>zkclient<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>        <span class="hljs-comment">&lt;!--日志会冲突--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.curator<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>curator-framework<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.12.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.curator<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>curator-recipes<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.12.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.zookeeper<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>zookeeper<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.4.14<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-comment">&lt;!--排除sl4j-log4j12--&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>slf4j-log4j12<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>2.配置注册中心的地址，以及服务的名字和需要扫描的包</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"># 服务应用名字<br>dubbo.application.name=provider-server<br># 注册中心地址<br>dubbo.registry.address=zookeeper://127.0.0.1:2181<br># 哪些服务需要被注册<br>dubbo.scan.base-packages=com.mao.service<br></code></pre></td></tr></table></figure>

<p>3.在想要被注册的服务上面增加一个注解@Service，注意这个注解是dubbo的</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.apache.dubbo.config.annotation.Service;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><span class="hljs-comment">//@Component//注意谨慎使用@Service注解,使用了dubbo后也有一个dubbo的@Service注解，容易混淆</span><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TicketServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">TicketService</span> </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getTicket</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;test dubbo service&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>消费者如何消费</p>
<p>1.导入相同的依赖</p>
<p>2.配置注册中心的地址，配置自己的服务名</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"># 消费者从哪里取服务，暴露出自己的名字<br>dubbo.application.name=consumer-server<br># 注册中心的地址<br>dubbo.registry.address=zookeeper://127.0.0.1:2181<br></code></pre></td></tr></table></figure>

<p>3.从远程注入服务@Reference，此时要注意两个模块的包路径需要一致，而且需要将相应的接口拷贝过去</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><span class="hljs-comment">//注意是加入到spring容器中</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserService</span> </span>&#123;<br>    <span class="hljs-comment">//希望拿到provider-server提供的票</span><br>    <span class="hljs-comment">//首先就是要去注册中心拿相应的服务</span><br>    <span class="hljs-meta">@Reference</span> <span class="hljs-comment">//引用法1.pom坐标 2.可以定义路径相同的接口名</span><br>    TicketService ticketService;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">buyTicket</span><span class="hljs-params">()</span></span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;从注册中心拿票中.......&quot;</span>);<br>        String ticket = ticketService.getTicket();<br>        System.out.println(<span class="hljs-string">&quot;在注册中心已拿到===&gt;&quot;</span> + ticket);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<div id="paginator"></div></div><p><strong>本文标题</strong>：SpringBoot笔记整理<br><strong>本文作者</strong>：MaoZH<br><strong>本文链接</strong>：<a href="/2021/10/06/SpringBoot%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/">https://jack-edward.github.io/2021/10/06/SpringBoot%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/</a><br><strong>版权声明</strong>：转载或借鉴请注明出处，保留以上声明信息！</p><div class="post_share"><div class="social-share share-component" data-image="https://cdn.jsdelivr.net/gh/hassanblog/CDN/img/cover_character_drawing.png" data-sites="facebook,twitter,wechat,weibo,qq,qzone,tencent,douban,diandian,google,linkedin"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="all" onload="this.media=&quot;all&quot;"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer=""></script></div><div id="post-footer"><hr><a href="/2021/10/06/Hive%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/">← Prev Hive数据仓库</a><span style="color: #fe2"> | </span><a href="/2021/09/22/Spring/">Spring Next →</a><hr></div><div id="bottom-btn"><a id="to-index" href="#post-index" title="index">≡</a><a id="to-top" href="#post-title" title="to top">∧</a></div><div id="Valine"></div><script>new Valine({
 el: '#Valine'
 , appId: 'TWFe26C7GQDWyvw3lVpQUswj-gzGzoHsz'
 , appKey: 'kA8WG8bPJQ16UwOnhf7TGdHn'
 , placeholder: '欢迎大家评论，感谢批评指正'
})</script></div></article><aside><form><div class="tipue_search_group"><input id="tipue_search_input" type="text" name="q" placeholder="Search Here" pattern=".{3,}" title="At least 3 characters" autofocus="autofocus" required=""><button class="tipue_search_button" type="submit"><div class="tipue_search_icon">⚲</div></button></div></form><div id="tipue_search_content"></div><script>$(document).ready(function() {
$('#tipue_search_input').tipuesearch();
});</script><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><div id="he-plugin-standard"></div><script>WIDGET = {
"CONFIG": {
"layout": "1",
"width": 450,
"height": 150,
"background": "3",
"dataColor": "FFFFFF",
"key": "e2043117ad6d459bb0eb89b26de1b4a2"
}
}</script><script src="https://widget.qweather.net/standard/static/js/he-standard-common.js?v=2.0"></script><h1 id="dr"><a href="/"> Mr.MaoZH</a></h1><section id="total"><a id="total-archives" href="/archives"><span class="total-title">Archives Total:</span><span class="total-number">6</span></a><div id="total-tags"><span class="total-title">Tags:</span><span class="total-number">7</span></div><div id="total-categories"><span class="total-title">Categories:</span><span class="total-number">3</span></div></section></div><div id="about-me"><span class="about-me">Contact-me:</span><a href="tencent://message/?uin=3128633651&amp;amp;site=qq&amp;amp;menu=yes"><img src="https://im.qq.com/favicon.ico"></a><a href="mailto:3128633651@qq.com"><img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/social/email.svg" width="20"></a></div><div id="aside-block"><div id="aside"><h1>INDEX</h1><div id="post-index"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringBoot"><span class="toc-number">1.</span> <span class="toc-text">SpringBoot</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84"><span class="toc-number">2.</span> <span class="toc-text">微服务架构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E5%BC%80%E5%8F%91%E4%B8%80%E4%B8%AAspringboot%E9%A1%B9%E7%9B%AE"><span class="toc-number">3.</span> <span class="toc-text">简单开发一个springboot项目</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringBoot%E5%8E%9F%E7%90%86"><span class="toc-number">4.</span> <span class="toc-text">SpringBoot原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#config%E9%85%8D%E7%BD%AE"><span class="toc-number">5.</span> <span class="toc-text">config配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#springboot-web%E5%BC%80%E5%8F%91"><span class="toc-number">6.</span> <span class="toc-text">springboot web开发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A6%96%E9%A1%B5"><span class="toc-number">7.</span> <span class="toc-text">首页</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E"><span class="toc-number">8.</span> <span class="toc-text">模板引擎</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MVC%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86"><span class="toc-number">9.</span> <span class="toc-text">MVC配置原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Springboot%E5%AE%9E%E6%88%98"><span class="toc-number">10.</span> <span class="toc-text">Springboot实战</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#springboot%E6%95%B4%E5%90%88JDBC"><span class="toc-number">11.</span> <span class="toc-text">springboot整合JDBC</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B4%E5%90%88DRUID%E6%95%B0%E6%8D%AE%E6%BA%90"><span class="toc-number">12.</span> <span class="toc-text">整合DRUID数据源</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B4%E5%90%88mybatis"><span class="toc-number">13.</span> <span class="toc-text">整合mybatis</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringSecurity"><span class="toc-number">14.</span> <span class="toc-text">SpringSecurity</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Shiro"><span class="toc-number">15.</span> <span class="toc-text">Shiro</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Swagger%E7%AE%80%E4%BB%8B"><span class="toc-number">16.</span> <span class="toc-text">Swagger简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1"><span class="toc-number">17.</span> <span class="toc-text">任务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Springboot%E6%95%B4%E5%90%88redis"><span class="toc-number">18.</span> <span class="toc-text">Springboot整合redis</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F"><span class="toc-number">19.</span> <span class="toc-text">分布式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#springboot%E6%95%B4%E5%90%88dubbo"><span class="toc-number">20.</span> <span class="toc-text">springboot整合dubbo</span></a></li></ol></div><div id="post-index"></div></div></div><footer><nobr><span class="text-title">©</span><span class="text-content">2020 to 2021</span></nobr><wbr><nobr><span class="text-title">ICP</span><span class="text-content">——备案号——</span></nobr><wbr><wbr><nobr>published with&nbsp;<a href="https://jack-edward.github.io">Zhihui Mao&nbsp;</a></nobr><wbr><nobr>Theme&nbsp;<a href="">Arknight&nbsp;</a></nobr><wbr><nobr>by&nbsp;<a href="">Yue_plus </a></nobr><wbr><script type="text/javascript" src="jquery.min.js"></script><script type="text/javascript">$(document).ready(function(){
//通过调用新浪IP地址库接口查询用户当前所在国家、省份、城市、运营商信息
$.getScript('https://pv.sohu.com/cityjson?ie=utf-8',function(){
$(".city").html(returnCitySN.cname);
$(".ip").html(returnCitySN.cip);
//$(".browser").html(navigator.appVersion);
});
});</script></footer><div>欢迎来自<span class="city"></span>地区的朋友<br>您的IP地址为：<span class="ip"></span><!--| <br>您的浏览器为：--><!--span.browser--><wbr><script type="text/javascript" src="//rf.revolvermaps.com/0/0/1.js?i=52al2pyccg1&amp;s=216&amp;m=0&amp;v=true&amp;r=false&amp;b=000000&amp;n=false&amp;c=ff0000" async="async"></script><wbr><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=406086764&auto=0&height=66"></iframe></div></aside></main><canvas id="canvas-dust"></canvas><script src="/js/arknights.js"></script><script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/10.1.2/highlight.min.js"></script></body></html>